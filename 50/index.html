<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>äº”åéŸ³æ³¡æ³¡éŠæˆ²</title>
<style>
  body {
    font-family: "Noto Sans JP", "Microsoft JhengHei", sans-serif;
    text-align: center;
    background: #f0f8ff;
    overflow: hidden;
    margin: 0;
  }
  h1 {
    font-size: 48px;
    margin: 20px 0 10px;
  }
  #mode-toggle {
    font-size: 24px;
    padding: 6px 14px;
    border-radius: 12px;
    background-color: #87ceeb;
    color: white;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
  }
  #question {
    font-size: 100px;
    font-weight: bold;
    margin: 20px 0;
  }
  #game-area {
    position: relative;
    width: 100vw;
    height: 60vh;
    overflow: hidden;
  }
  .bubble {
    position: absolute;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 48px;
    cursor: pointer;
    transition: transform 0.2s;
    user-select: none;
  }
  .bubble:hover {
    transform: scale(1.1);
  }
  .correct {
    background-color: #90ee90 !important;
    color: white !important;
  }
  .wrong {
    background-color: transparent !important;
    color: gray !important;
    border: 2px dashed #ccc !important;
  }
  #controls {
    margin-top: 20px;
  }
  button {
    font-size: 24px;
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    background-color: #4682b4;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>
  <h1>äº”åéŸ³æ³¡æ³¡éŠæˆ²</h1>
  <button id="mode-toggle">åˆ‡æ›ç‚ºç‰‡å‡å</button>
  <div id="question"></div>
  <div id="game-area"></div>
  <div id="controls">
    <button id="restart">é‡æ–°é–‹å§‹</button>
  </div>

<script>
const hiragana = [
  "ã‚","ã„","ã†","ãˆ","ãŠ",
  "ã‹","ã","ã","ã‘","ã“",
  "ã•","ã—","ã™","ã›","ã",
  "ãŸ","ã¡","ã¤","ã¦","ã¨",
  "ãª","ã«","ã¬","ã­","ã®",
  "ã¯","ã²","ãµ","ã¸","ã»",
  "ã¾","ã¿","ã‚€","ã‚","ã‚‚",
  "ã‚„","ã‚†","ã‚ˆ",
  "ã‚‰","ã‚Š","ã‚‹","ã‚Œ","ã‚",
  "ã‚","ã‚’","ã‚“"
];

const katakana = [
  "ã‚¢","ã‚¤","ã‚¦","ã‚¨","ã‚ª",
  "ã‚«","ã‚­","ã‚¯","ã‚±","ã‚³",
  "ã‚µ","ã‚·","ã‚¹","ã‚»","ã‚½",
  "ã‚¿","ãƒ","ãƒ„","ãƒ†","ãƒˆ",
  "ãƒŠ","ãƒ‹","ãƒŒ","ãƒ","ãƒ",
  "ãƒ","ãƒ’","ãƒ•","ãƒ˜","ãƒ›",
  "ãƒ","ãƒŸ","ãƒ ","ãƒ¡","ãƒ¢",
  "ãƒ¤","ãƒ¦","ãƒ¨",
  "ãƒ©","ãƒª","ãƒ«","ãƒ¬","ãƒ­",
  "ãƒ¯","ãƒ²","ãƒ³"
];

let currentSet = hiragana;
let currentQuestion = "";
let questionCount = 0;
const totalQuestions = 10;

const questionDiv = document.getElementById("question");
const gameArea = document.getElementById("game-area");
const restartBtn = document.getElementById("restart");
const modeBtn = document.getElementById("mode-toggle");

// ç”Ÿæˆéš¨æ©Ÿä¸é‡ç–Šæ³¡æ³¡
function generateBubbles(correctKana) {
  gameArea.innerHTML = "";
  const usedPositions = [];
  const allKana = [...currentSet];
  const options = [correctKana];

  while (options.length < 10) {
    const rand = allKana[Math.floor(Math.random() * allKana.length)];
    if (!options.includes(rand)) options.push(rand);
  }

  options.sort(() => Math.random() - 0.5);

  options.forEach(kana => {
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = kana;

    const size = Math.floor(Math.random() * 50) + 80;
    bubble.style.width = size + "px";
    bubble.style.height = size + "px";
    bubble.style.backgroundColor = "#add8e6";

    let top, left, overlap;
    do {
      overlap = false;
      top = Math.random() * (gameArea.clientHeight - size);
      left = Math.random() * (gameArea.clientWidth - size);
      for (let pos of usedPositions) {
        const dx = pos.left - left;
        const dy = pos.top - top;
        if (Math.sqrt(dx * dx + dy * dy) < (pos.size + size) / 1.5) {
          overlap = true;
          break;
        }
      }
    } while (overlap);
    usedPositions.push({ top, left, size });

    bubble.style.top = `${top}px`;
    bubble.style.left = `${left}px`;

    bubble.onclick = () => checkAnswer(kana, bubble);
    gameArea.appendChild(bubble);
  });
}

// é¡Œç›®æ’­æ”¾èªéŸ³
function speakKana(kana) {
  const utter = new SpeechSynthesisUtterance(kana);
  utter.lang = "ja-JP";
  speechSynthesis.speak(utter);
}

function newQuestion() {
  if (questionCount >= totalQuestions) {
    alert("ğŸ‰ å…¨éƒ¨ç­”å°äº†ï¼");
    return;
  }
  currentQuestion = currentSet[Math.floor(Math.random() * currentSet.length)];
  questionDiv.textContent = currentQuestion;
  questionCount++;
  generateBubbles(currentQuestion);
  speakKana(currentQuestion);
}

function checkAnswer(selected, bubble) {
  if (selected === currentQuestion) {
    bubble.classList.add("correct");
    setTimeout(newQuestion, 800);
  } else {
    bubble.classList.add("wrong");
    bubble.textContent = "";
  }
}

restartBtn.onclick = () => {
  questionCount = 0;
  newQuestion();
};

modeBtn.onclick = () => {
  currentSet = currentSet === hiragana ? katakana : hiragana;
  modeBtn.textContent = currentSet === hiragana ? "åˆ‡æ›ç‚ºç‰‡å‡å" : "åˆ‡æ›ç‚ºå¹³å‡å";
  questionCount = 0;
  newQuestion();
};

newQuestion();
</script>
</body>
</html>
